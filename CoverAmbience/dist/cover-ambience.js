!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));(()=>{var e,t,c=Object.create,l=Object.defineProperty,s=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,y=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,i=(e,t,i)=>{i=null!=e?c(y(e)):{};var a=!t&&e&&e.__esModule?i:l(i,"default",{value:e,enumerable:!0}),n=e,r=void 0,o=void 0;if(n&&"object"==typeof n||"function"==typeof n)for(let e of m(n))g.call(a,e)||e===r||l(a,e,{get:()=>n[e],enumerable:!(o=s(n,e))||o.enumerable});return a},a=(e,t,i)=>{var a;return a=i,(t="symbol"!=typeof t?t+"":t)in(e=e)?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,i},n=(e={"external-global-plugin:react"(e,t){t.exports=Spicetify.React}},function(){return t||(0,e[m(e)[0]])((t={exports:{}}).exports,t),t.exports}),r=i(n()),o=class{static getSetting(e){var t=localStorage.getItem(o.storageKeyPrefix+":"+e);return null==t?o.defaultSettings[e]:JSON.parse(t)}static setSetting(e,t){o.callbacks.get(e)?.forEach(e=>e(t)),localStorage.setItem(o.storageKeyPrefix+":"+e,JSON.stringify(t))}static subscribeToSetting(e,t){o.callbacks.has(e)||o.callbacks.set(e,new Set),o.callbacks.get(e).add(t)}},d=o,p=(a(d,"storageKeyPrefix","cover-ambience"),a(d,"defaultSettings",{opacity:1,"make-text-white":!0}),a(d,"callbacks",new Map),i(n())),u=p.default["useState"],{getSetting:b,setSetting:f}=d;function S(){const[e,t]=u(b("opacity")),[i,a]=u(b("make-text-white"));var n=e=>{e*=100,t(e),f("opacity",e)};return p.default.createElement("div",{className:"ambience-settings"},p.default.createElement("div",{className:"x-settings-section"},p.default.createElement("div",{className:"x-settings-row"},p.default.createElement("div",{className:"x-settings-firstColumn"},p.default.createElement("p",null,"Opacity (%)")),p.default.createElement("div",{className:"x-settings-secondColumn"},p.default.createElement(Spicetify.ReactComponent.Slider,{max:100,step:1,value:e,onDragStart:()=>{},onDragMove:n,onDragEnd:n}),p.default.createElement("span",null,Math.round(e)))),p.default.createElement("div",{className:"x-settings-row"},p.default.createElement("div",{className:"x-settings-firstColumn"},p.default.createElement("p",null,"Make text white")),p.default.createElement("div",{className:"x-settings-secondColumn"},p.default.createElement(Spicetify.ReactComponent.Toggle,{value:i,onSelected:e=>{a(e),f("make-text-white",e)}})))))}var w=".main-nowPlayingWidget-nowPlaying",{getSetting:h,subscribeToSetting:x}=d,v=class{static setWidth(){if(v.nowPlayingWidget.isConnected){let t=80+parseFloat(getComputedStyle(v.nowPlayingBarLeft).paddingInlineStart||"0");Array.from(v.nowPlayingWidget.children).forEach(e=>{e instanceof HTMLElement&&(t+=e.offsetWidth)}),v.ambienceStyle.width=t+"px"}else v.initElements()}static async setAmbienceColorAsync(){var e=(await Spicetify.colorExtractor(Spicetify.Player.data?.item.uri))["DARK_VIBRANT"];e&&(v.ambienceStyle.backgroundColor=""+e)}static setAmbienceDimensions(){var e=parseInt(getComputedStyle(v.rootNowPlayingBar).getPropertyValue("--panel-gap"),10),t=v.rootNowPlayingBar.offsetHeight+(v.isLibaryX?2*e:0);v.ambienceStyle.height=t+"px",v.isLibaryX&&(v.ambienceStyle.marginTop=`-${e}px`,v.ambienceStyle.marginLeft=`-${e}px`)}static setTextColor(e=h("make-text-white")){e?(v.textStyle||(v.textStyle=document.createElement("style"),document.head.appendChild(v.textStyle)),v.textStyle.innerHTML=`
        ${w} {
          --text-subdued: white !important;
          --spice-subtext: white !important;
          --spice-text: white !important;
        }
      `):v.textStyle&&(v.textStyle.innerHTML="")}static applyThemeFixes(e=Spicetify.Config.current_theme){switch(e.toLowerCase()){case"bloom":v.ambienceStyle.marginTop="",v.ambienceStyle.marginLeft="",v.ambienceStyle.height="100%";break;case"dribbblish":v.ambienceStyle.marginTop="",v.ambienceStyle.marginLeft="",v.ambienceStyle.height=""+getComputedStyle(v.rootNowPlayingBar).height;break;case"comfy":var t;v.isLibaryX||(v.ambienceStyle.zIndex="1",(t=document.querySelector(".main-nowPlayingBar-nowPlayingBar"))instanceof HTMLElement&&(t.style.zIndex="1"))}}static createAmbience(){var e=document.createElement("div");e.classList.add("ambience-gradient"),v.ambienceStyle=e.style,v.rootNowPlayingBar.insertAdjacentElement("afterbegin",e)}static keepTextColor(){v.setTextColor(),x("make-text-white",v.setTextColor)}static keepAmbienceOpacity(){v.ambienceStyle.opacity=h("opacity")+"%",x("opacity",e=>{v.ambienceStyle.opacity=e+"%"})}static keepAmbienceColor(){v.setAmbienceColorAsync(),Spicetify.Player.addEventListener("songchange",v.setAmbienceColorAsync)}static keepAmbienceWidth(){v.setWidth(),new MutationObserver(v.setWidth).observe(v.nowPlayingBarLeft,{childList:!0,subtree:!0}),window.addEventListener("resize",v.setWidth)}static keepAmbienceDimensionsAndFixes(){v.setAmbienceDimensions(),v.applyThemeFixes();let e=Spicetify.Config["current_theme"];setInterval(()=>{e!==Spicetify.Config.current_theme&&(e=Spicetify.Config.current_theme,v.setAmbienceDimensions(),v.applyThemeFixes(e))},1e3)}static registerMenu(){new Spicetify.Menu.Item("Cover Ambience Settings",!1,()=>{Spicetify.PopupModal.display({title:"Cover Ambience Settings",content:r.default.createElement(S,null),isLarge:!0})}).register()}static initElements(){var e=document.querySelector(".Root__now-playing-bar"),t=document.querySelector(w),i=document.querySelector(".main-nowPlayingBar-left"),a=document.querySelector("[class*='yourLibraryX']");e instanceof HTMLDivElement&&t instanceof HTMLElement&&i instanceof HTMLElement&&(v.rootNowPlayingBar=e,v.nowPlayingWidget=t,v.nowPlayingBarLeft=i,v.isLibaryX=Boolean(a))}static init(){v.initElements(),Spicetify.Player&&Spicetify.colorExtractor&&Spicetify.Config&&Spicetify.Menu&&Spicetify.PopupModal&&v.rootNowPlayingBar&&v.nowPlayingWidget&&v.nowPlayingBarLeft?(v.createAmbience(),v.keepTextColor(),v.keepAmbienceColor(),v.keepAmbienceWidth(),v.keepAmbienceDimensionsAndFixes(),v.keepAmbienceOpacity(),v.registerMenu()):setTimeout(v.init,300)}},P=v;a(P,"ambienceStyle"),a(P,"rootNowPlayingBar"),a(P,"nowPlayingWidget"),a(P,"nowPlayingBarLeft"),a(P,"isLibaryX"),a(P,"textStyle");var E=function(){P.init()};(async()=>{await E()})()})();(async()=>{var e;document.getElementById("coverDambience")||((e=document.createElement("style")).id="coverDambience",e.textContent=String.raw`
  .ambience-gradient{position:absolute;transition:width .4s ease,background-color .5s ease;border-top-left-radius:inherit;border-bottom-left-radius:inherit;-webkit-mask-image:linear-gradient(to right,black 0%,transparent 100%)}body:has(.BeautifulLyricsPage) .ambience-gradient{background-color:unset!important}.ambience-settings .x-settings-secondColumn:has(.playback-progressbar) span{margin-left:12px;width:40px}
      `.trim(),document.head.appendChild(e))})()}();